---
title: 并发学习
date: 2021-06-09 22:29:23
tags: 
	- 并发
categories:
	- 并发
---

# CPU线程调度

## 算法概念

假设计算机只有一个 CPU ，则在任意时刻只能执行一条机器指令，每个线程只有获得 CPU 的使用权才能执行指令。 

- 所谓多线程的并发运行，其实是指从宏观上看，各个线程轮流获得 CPU 的使用权，分别执行各自的任务。 
- 在运行池中，会有多个处于就绪状态的线程在等待 CPU ，Java 虚拟机的一项任务就是负责线程的调度，线程调度是指按照特定机制为多个线程分配 CPU 的使用权。 



有两种调度模型：**分时调度模型**和**抢占式调度模型**。 

- 分时调度模型是指让所有的线程轮流获得 CPU 的使用权,并且平均分配每个线程占用的 CPU 的时间片这个也比 

较好理解。 

- Java 虚拟机采用抢占式调度模型，是指优先让可运行池中优先级高的线程占用 CPU ，如果可运行池中的线程优先级相同，那么就随机选择一个线程，使其占用 CPU 。处于运行状态的线程会一直运行，直至它不得不放弃 

CPU 。



## 线程饥饿概念

饥饿，一个或者多个线程因为种种原因无法获得所需要的资源，导致一直无法执行的状态。 

Java 中导致饥饿的原因： 

- 高优先级线程吞噬所有的低优先级线程的 CPU 时间。 
- 线程被永久堵塞在一个等待进入同步块的状态，因为其他线程总是能在它之前持续地对该同步块进行访 

问。 

- 线程在等待一个本身也处于永久等待完成的对象(比如调用这个对象的 wait 方法)，因为其他线程总是被持 

续地获得唤醒。



## 线程优化级概念

每一个线程都是有优先级的，一般来说，高优先级的线程在运行时会具有优先权，但这依赖于线程调度的实 

现，这个实现是和操作系统相关的(OS dependent)。 

- 我们可以定义线程的优先级，但是这并不能保证高优先级的线程会在低优先级的线程前执行。线程优先级 

是一个 int 变量(从1-10)，1 代表最低优先级，10 代表最高优先级。 

- Java 的线程优先级调度会委托给操作系统去处理，所以与具体的操作系统优先级有关，如非特别需要，一 

般无需设置线程优先级。



## 进程

### 概念

计算机的核心是CPU，它承担了所有的计算任务，而操作系统是计算机的管理者，它负责任务的调度，资源的分配和管理，统领整个计算机硬件；应用程序是具有某种功能的程序，程序是运行于操作系统之上的。



**进程**是一个具有一定独立功能的程序在一个数据集上的一次动态执行的过程，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。进程是一种抽象的概念，从来没有统一的标准定义。



进程一般由**程序，数据集合和进程控制块三部分**组成。

- 程序用于**描述进程要完成**的功能，是控制进程执行的**指令集**；
- 数据集合是程序在执行时**所需要的数据和工作区**；

- 程序控制块包含**进程的描述信息**和是进程存在的唯一标志。

进程具有的特征：

**动态性**：进程是程序的一次执行过程，是临时的，有生命期的，是动态产生，动态消亡的；

**并发性**：任何进程都可以同其他进程一起并发执行；

**独立性**：进程是系统进行资源分配和调度的一个独立单位；

**结构性**：进程由程序，数据和进程控制块三部分组成。



## 线程

### 概念

在早期的操作系统中并没有线程的概念，**进程是拥有资源和独立运行的最小单位**，也是程序执行的最小单位。任务调度采用的是时间片轮转的抢占式调度方式，而进程是任务调度的最小单位，每个进程有各自独立的一块内存，使得各个进程之间内存地址相互隔离。

后来随着计算机的发展，对CPU的要求越来越高，进程之间的切换开销较大，已经无法满足越来越复杂的程序的要求了。于是就发明了线程，线程是程序执行中一个单一的顺序控制流程，**是程序执行流的最小单元**，是处理器调度和分派的基本单位。**一个进程可以有一个或多个线程**，**各个线程之间共享程序的内存空间**(也就是所在进程的内存空间)。一个标准的线程由线程ID，当前指令指针PC，寄存器和堆栈组成。

而进程由内存空间(代码，数据，进程空间，打开的文件)和一个或多个线程组成。



### 生命周期

![img](https://cdn.nlark.com/yuque/0/2021/png/705191/1623554892415-b0bd3eab-2610-42be-b11d-8599e70d0d09.png)

![img](https://cdn.nlark.com/yuque/0/2021/png/705191/1623555150026-859acd76-66cc-4ee7-be64-eb5a767a1296.png)



# JMM模型

## 概念

**Java内存模型**(Java Memory Model简称JMM)是一种抽象的概念，并不真实存在，它描述的是**一组规则或规范**，通过这组规范定义了程序中各个变量（包括实例字段，静态字段和构成数组对象的元素）的访问方式。**JVM运行程序的实体是线程**，而每个线程创建时JVM都会为其创建一个**工作内存(有些地方称为栈空间)**，用于存储线程私有的数据。

而Java内存模型中规定所有变量都存储在主内存，**主内存是共享内存区域**，所有线程都可以访问，但线程对变量的操作(读取赋值等)必须在工作内存中进行，首先要将变量**从主内存拷贝的自己的工作内存空间**，然后对变量进行操作，操作完成后**再将变量写回主内存**，不能直接操作主内存中的变量，工作内存中存储着主内存中的变量副本拷贝，前面说过，工作内存是每个线程的私有数据区域，因此不同的线程间无法访问对方的工作内存，线程间的通信(传值)必须通过主内存来完成。

![img](https://cdn.nlark.com/yuque/0/2021/png/705191/1623595159054-7fed6ad8-a511-4cdf-b53d-9cabd433d336.png)





## JMM与JVM内存的不同

### JMM内存

#### 主内存 

主要存储的是Java实例对象，所有线程创建的实例对象都存放在主内存中，不管该实例对象是成员变量还是方法中的本地变量(也称局部变量)，当然也包括了共享的类信息、常量、静态变量。由于是共享数据区域，多条线程对同一个变量进行访问可能会发生线程安全问题。





## JMM模型的重要性

## 八大原子操作



## 并发三大特性



# volatile内存语义



# CPU缓存一致性协议
